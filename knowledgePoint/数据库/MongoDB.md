### 1、 什么是MongoDB？
* 由C++语言编写，分布式文件存储的开源数据库系统。旨在为WEB应用提供可扩展的高性能数据存储解决方案。
MongoDB是一个介于关系数据库和非关系数据库之间的产品。
* 它支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型
* Mongo最大的特点是它支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。
### 2、 MongoDB特点
**特点是高性能、易部署、易使用，存储数据非常方便**
* 面向集合存储，易存储对象类型的数据。集合类似RDBMS 中的表，一个集合中可以存储无限多的文档。
模式自由，采用无模式结构存储。采用无模式存储数据是集合区别于RDBMS 中的表的一个重要特征。
* 支持动态查询
* 支持完全索引，可以在任意属性上建立索引，包含内部对象。MongoDB的索引和RDBMS 的索引基本一样，可以在指定属性、内部对象上创建索引以提高查询的速度。除此之外，MongoDB 还提供创建基于地理空间的索引的能力。
支持查询。几乎支持SQL中的大部分查询。
* 强大的聚合工具。如count、group 等，支持使用MapReduce 完成复杂的聚合任务。
* 支持复制和故障恢复。MongoDB 支持主从复制机制，可以实现数据备份、故障恢复、读扩展等功能。而基于副本集的复制机制提供了自动故障恢复的功能，确保了集群数据不会丢失。高可用性与数据持久化。
* 使用高效的二进制数据存储，包括大型对象（如视频等）。使用二进制格式存储，可以保存任何类型的数据对象。
自动处理碎片，以支持云计算层次的扩展性。MongoDB 支持集群自动切分数据，对数据进行分片可以使集群存储更多的数据，实现更大的负载，也能保证存储的负载均衡。
* 支持RUBY，PYTHON，JAVA，C++，PHP，C#等多种语言的驱动程序。MongoDB 提供了当前所有主流开发语言的数据库驱动包，开发人员使用任何一种主流开发语言都可以轻松编程，实现访问MongoDB 数据库。
* 文件存储格式为BSON（一种JSON的扩展）
* 可通过网络访问。可以通过网络远程访问MongoDB 数据库。
* 多存储引擎。mmapv1, wiredTiger, In-mermory, RocksDB
### 3、使用原理
* 所谓“面向集合”（Collection-Oriented），意思是数据被分组存储在数据集中，被称为一个集合（Collection)。每个集合在数据库中都有一个唯一的标识名，并且可以包含无限数目的文档。集合的概念类似关系型数据库（RDBMS）里的表（table），不同的是它不需要定义任何模式（schema)。Nytro MegaRAID技术中的闪存高速缓存算法，能够快速识别数据库内大数据集中的热数据，提供一致的性能改进。
* 模式自由（schema-free)，意味着对于存储在mongodb数据库中的文件，我们不需要知道它的任何结构定义。如果需要的话，你完全可以把不同结构的文件存储在同一个数据库里。
存储在集合中的文档，被存储为键-值对的形式。键用于唯一标识一个文档，为字符串类型，而值则可以是各种复杂的文件类型。我们称这种存储形式为BSON（Binary Serialized Document Format）。
* 分布式文件系统（Distributed File System）是指文件系统管理的物理存储资源不一定直接连接在本地节点上，而是通过计算机网络与节点相连。分布式文件系统的设计基于客户机/服务器模式。一个典型的网络可能包括多个供多用户访问的服务器。另外，对等特性允许一些系统扮演客户机和服务器的双重角色。
高性能—支持嵌入式数据模型，可减少数据库的I/O代价。
### 4、 使用场景
**适用于：**
* 网站实时数据处理。它非常适合实时的插入、更新与查询，并具备网站实时数据存储所需的复制及高度伸缩性。
* 缓存。由于性能很高，它适合作为信息基础设施的缓存层。在系统重启之后，由它搭建的持久化缓存层可以避免下层的数据源过载。
* 高伸缩性的场景。非常适合由数十或数百台服务器组成的数据库，它的路线图中已经包含对MapReduce引擎的内置支持。
* 用于对象及JSON 数据的存储：Mongo 的BSON 数据格式非常适合文档化格式的存储及查询。
* 无多文档事务性需求以及复杂关联检索
* 业务快速迭代，需求频繁变动的行业
* 数据模型不固定，存储格式灵活的场景
* 单集群读写并发过大无法支撑业务增长
* 数据量持续增长预期TB及以上的存储需求
* 期望要求数据库高可用场景 

**不适用：**
* 要求高度事务性的系统。传统的关系型数据库目前还是更适用于需要大量原子性复杂事务的应用程序。
传统的商业智能应用。针对特定问题的BI 数据库会产生高度优化的查询方式
* 复杂的跨文档（表）级联查询。 

**实际应用场景** 
* 1、 游戏场景 
使用MongoDB存储游戏用户信息，游戏的装备，积分等直接用内嵌文档的方式进行存储，方便查询与更新。 
* 2、 物流场景 
使用MongoDB 存储订单信息，订单状态在运输过程中会不断更新，以MongoDB内嵌数组的形式进行存储，一次查询就能将订单的所有变更信息读取出来。 
* 3、 社交场景 
使用MongoDB存储用户信息，以及用户发表的朋友圈信息，通过地理位置索引实现附近的人、地点等功能。 
* 4、 物联网场景 
使用MongoDB存储所有接入的智能设备信息，以及智能设备汇报的日志信息，并对这些信息进行多维度分析。 
* 5、 视频直播场景 
使用MongoDB存储用户信息，礼物，私信信息等。
### 5、基本概念
**文档**
文档是 MongoDB 中数据的基本单位，类似于关系数据库中的行（但是比行复杂）。多个键及其关联的值有序地放在一起就构成了文档。文档中的键/值对是有序的。

文档中的值不仅可以是双引号中的字符串，也可以是其他的数据类型，例如，整型、布尔型等，也可以是另外一个文档，即文档可以嵌套。文档中的键类型只能是字符串。 

**集合**
集合就是一组文档，类似于关系数据库中的表。集合是无模式的，集合中的文档可以是各式各样的。 

例如，{“hello,word”:“Mike”}和{“foo”: 3}，它们的键不同，值的类型也不同，但是它们可以存放在同一个集合中，也就是不同模式的文档都可以放在同一个集合中。

既然集合中可以存放任何类型的文档，那么为什么还需要使用多个集合？ 
这是因为所有文档都放在同一个集合中，无论对于开发者还是管理员，都很难对集合进行管理，而且这种情形下，对集合的查询等操作效率都不高。所以在实际使用中，往往将文档分类存放在不同的集合中，例如，对于网站的日志记录，可以根据日志的级别进行存储，Info级别日志存放在Info 集合中，Debug 级别日志存放在Debug 集合中，这样既方便了管理，也提供了查询性能。但是需要注意的是，这种对文档进行划分来分别存储并不是MongoDB 的强制要求，用户可以灵活选择。
可以使用“.”按照命名空间将集合划分为子集合。 

例如，对于一个博客系统，可能包括blog.user 和blog.article 两个子集合，这样划分只是让组织结构更好一些，blog 集合和blog.user、blog.article 没有任何关系。虽然子集合没有任何特殊的地方，但是使用子集合组织数据结构清晰，这也是MongoDB 推荐的方法。
 
**数据库** 
MongoDB 中多个文档组成集合，多个集合组成数据库。一个MongoDB 实例可以承载多个数据库。它们之间可以看作相互独立，每个数据库都有独立的权限控制。在磁盘上，不同的数据库存放在不同的文件中。 
MongoDB 中存在以下系统数据库：
* Admin 数据库：一个权限数据库，如果创建用户的时候将该用户添加到admin 数据库中，那么该用户就自动继承了所有数据库的权限。
* Local 数据库：这个数据库永远不会被复制，可以用来存储本地单台服务器的任意集合。
* Config 数据库：当MongoDB 使用分片模式时，config 数据库在内部使用，用于保存分片的信息。
### 6、数据模型
一个MongoDB 实例可以包含一组数据库，一个DataBase 可以包含一组Collection（集合），一个集合可以包含一组Document（文档）。一个Document包含一组field（字段），每一个字段都是一个key/value pair。
**key: 必须为字符串类型。** 
value：可以包含如下类型。 
* 基本类型，例如，string，int，float，timestamp，binary 等类型。 
*  一个document。 
* 数组类型。

### 7、MongoDB与关系型数据库RDBMS区别
RDBMS MongoDB
数据库 数据库
表格 集合
行 文档
列 字段
表联合 嵌入文档
主键 主键 (MongoDB 提供了 key 为 _id )
 
**注意：**
* 文档中的键/值对是有序的。
* 文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。
* MongoDB区分类型和大小写。
* MongoDB的文档不能有重复的键。
* 文档的键是字符串。除了少数例外情况，键可以使用任意UTF-8字符。 
* 文档键命名规范：
	* 键不能含有\0 (空字符)。这个字符用来表示键的结尾。
	* .和$有特别的意义，只有在特定环境下才能使用。
	* 以下划线”_”开头的键是保留的(不是严格要求的)。 
* 合法的集合名：
	* 集合名不能是空字符串”“。
	* 集合名不能含有\0字符（空字符)，这个字符表示集合名的结尾。
	* 集合名不能以”system.”开头，这是为系统集合保留的前缀。
	* 用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除非你要访问这种系统创建的集合，否则千万不要在名字里出现$。　
### 8、MongoDB 数据类型
数据类型 描述:
* String 字符串。存储数据常用的数据类型。在 MongoDB 中，UTF-8 编码的字符串才是合法的。
* Integer 整型数值。用于存储数值。根据你所采用的服务器，可分为 32 位或 64 位。
* Boolean 布尔值。用于存储布尔值（真/假）。
* Double 双精度浮点值。用于存储浮点值。
* Min/Max keys 将一个值与 BSON（二进制的 JSON）元素的最低值和最高值相对比。
* Array 用于将数组或列表或多个值存储为一个键。
* Timestamp 时间戳。记录文档修改或添加的具体时间。
* Object 用于内嵌文档。
* Null 用于创建空值。
* Symbol 符号。该数据类型基本上等同于字符串类型，但不同的是，它一般用于采用特殊符号类型的语言。
* Date 日期时间。用 UNIX 时间格式来存储当前日期或时间。你可以指定自己的日期时间：创建 Date 对象，传入年月日信息。
* Object ID 对象 ID。用于创建文档的 ID。
* Binary Data 二进制数据。用于存储二进制数据。
* Code 代码类型。用于在文档中存储 JavaScript 代码。
* Regular expression 正则表达式类型。用于存储正则表达式。
### 9、MongoDB 索引
索引通常能够极大的提高查询的效率，如果没有索引，MongoDB在读取数据时必须扫描集合中的每个文件并选取那些符合查询条件的记录。这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可以要花费几十秒甚至几分钟，这对网站的性能是非常致命的。
索引是特殊的数据结构，索引存储在一个易于遍历读取的数据集合中，索引是对数据库表中一列或多列的值进行排序的一种结构

**常见的索引类型：**
* 单列、多列索引
* 多key索引
* 哈希索引
* 地理索引
* 文本索引
常见的索引属性：
* 唯一索引
* TTL索引
* 部分索引
* 稀疏索引

**语法** 

```
db.collection.createIndex(keys, options)
```

语法中 Key 值为你要创建的索引字段，1 为指定按升序创建索引，如果你想按降序来创建索引指定为 -1 即可。 
例子：db.col.createIndex({“title”:1})；复合索引：db.col.createIndex({“title”:1,”description”:-1}) 
索引的限制 
额外开销：
### 10、MongoDB 聚合
MongoDB中聚合(aggregate)主要用于处理数据(诸如统计平均值,求和等)，并返回计算后的数据结果。有点类似sql语句中的 count(*)。
**语法** 

```
db.COLLECTION_NAME.aggregate(AGGREGATE_OPERATION)
```

### 11、MongoDB 复制（副本集）
MongoDB复制是将数据同步在多个服务器的过程。 
复制提供了数据的冗余备份，并在多个服务器上存储数据副本，提高了数据的可用性， 并可以保证数据的安全性。 
复制还允许您从硬件故障和服务中断中恢复数据。
* 保障数据的安全性
* 数据高可用性 (24*7)
* 灾难恢复无需停机维护（如备份，重建索引，压缩）

**分布式读取数据** 
mongodb的复制至少需要两个节点。其中一个是主节点，负责处理客户端请求，其余的都是从节点，负责复制主节点上的数据。 
mongodb各个节点常见的搭配方式为：**一主一从、一主多从**。 
主节点记录在其上的所有操作oplog，从节点定期轮询主节点获取这些操作，然后对自己的数据副本执行这些操作，从而保证从节点的数据与主节点一致。

**特征**
* N 个节点的集群
* 任何节点可作为主节点
* 所有写入操作都在主节点上
* 自动故障转移
* 自动恢复 
* MongoDB的副本集与我们常见的主从有所不同，主从在主机宕机后所有服务将停止，而副本集在主机宕机后，副本会接管主节点成为主节点，不会出现宕机的情况。
### 12、MongoDB 分片
在Mongodb里面存在另一种集群，就是分片技术,可以满足MongoDB数据量大量增长的需求。 
当MongoDB存储海量的数据时，一台机器可能不足以存储数据，也可能不足以提供可接受的读写吞吐量。这时，我们就可以通过在多台机器上分割数据，使得数据库系统能存储和处理更多的数据。 
为什么使用分片?
* 复制所有的写入操作到主节点
* 延迟的敏感数据会在主节点查询
* 单个副本集限制在12个节点
* 当请求量巨大时会出现内存不足。
* 本地磁盘不足
* 垂直扩展价格昂贵
### 13、 MongoDB 原子操作
**mongodb不支持事务，无论什么设计，都不要要求mongodb保证数据的完整性。** 
但是mongodb提供了许多原子操作，比如文档的保存，修改，删除等，都是原子操作。 
所谓原子操作就是要么这个文档保存到Mongodb，要么没有保存到Mongodb，不会出现查询到的文档没有保存完整的情况。