### 异步
#### 异步的概念
打个比方：现在执行一个事情，但这个事情不是现在立刻就执行，而是过一段时间再执行。过一段时间之后才能得知结果

*  JS中的异步，通过回调函数实现（例如 setTimeout通过回调函数实现），ES6 中使用promise，到 async 和 await ，
*  回调函数的缺点： 如何一个事情需要依赖另一个事情的执行结果，则需要嵌套执行，层层嵌套是相当繁琐的。
*  promise 可以通过.then()来执行下一个操作，但是也有缺点：promise同样也是链式调用，调用多个也将会比较长


####  Promise

``` javascript
const promise = new Promise(function(resolve, reject) {
  // ... some code

  if (/* 异步操作成功 */){
    resolve(value);
  } else {
    reject(error);
  }
});

promise.then(function(value) {
  // success
}, function(error) {
  // failure
});
```
Promise 新建后就会立即执行。Promise本身是同步的立即执行函数， 当在 executor 中执行 resolve 或者 reject 的时候, 此时是异步操作， 会先执行 then/catch 等，当主栈完成后，才会去调用 resolve/reject 中存放的方法执行。

``` javascript
let promise = new Promise(function(resolve, reject) {
  console.log('Promise');
  resolve();
});

promise.then(function() {
  console.log('resolved.');
});

console.log('Hi!');

// Promise
// Hi!
// resolved
```
#### async 
async函数的返回值是 Promise 对象，可以使用then方法添加回调函数。当函数执行的时候，一旦遇到await就会先返回，等到异步操作完成，再接着执行函数体内后面的语句。await命令后面是一个 Promise 对象，返回该对象的结果，如果不是 Promise 对象，会调用 Promise.resolve(值) 转化为Promise 对象。

```javascript
// 今日头条面试题
async function async1() {
    console.log('async1 start')
    await async2()
    console.log('async1 end')
}
async function async2() {
    console.log('async2')
}
console.log('script start')
setTimeout(function () {
    console.log('settimeout')
})
async1()
new Promise(function (resolve) {
    console.log('promise1')
    resolve()
}).then(function () {
    console.log('promise2')
})
console.log('script end')

 // script start
 // async1 start
 // async2
 // promise1
 // script end
 // async1 end
 // promise2
 // settimeout
```
（1）async1，async2都是函数定义，先同步任务，打印script start

（2）setTimeout 先挂起。

（3）执行async1()，打印 async1 start，调用async2()，打印async2，先返回，将它后面的代码 `console.log('async1 end')` push 进微任务队列中。

（4）因为 Promise 会立即执行，所以打印出 promise1，将.then 里面的代码 ` console.log('promise2') ` push进微任务队列中

（5）打印 script end 。同步任务执行完，接下来从微任务队列中取。

（6）打印 async1 end

（7）打印 promise2。此时微任务队列为空，则去宏任务队列中取。

（8）到时间(浏览器最小时间4ms)，将setTimeout中回调函数push 进宏任务队列中

（9）执行回调函数 打印 settimeout

#### Promise 与 async 区别
* promise执行异步的方式是 : .then() .then 链式调用
* async 是 await funcA;  await funcB;  将异步变成同步的写法,本质还是异步的。
